<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Detect doublet clusters — findDoubletClusters • scDblFinder</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Detect doublet clusters — findDoubletClusters"><meta name="description" content="Identify potential clusters of doublet cells based on whether they have intermediate expression profiles,
i.e., their profiles lie between two other &amp;#8220;source&amp;#8221; clusters."><meta property="og:description" content="Identify potential clusters of doublet cells based on whether they have intermediate expression profiles,
i.e., their profiles lie between two other &amp;#8220;source&amp;#8221; clusters."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">scDblFinder</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.19.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/scDblFinder.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/computeDoubletDensity.html">Scoring potential doublets from simulated densities</a></li>
    <li><a class="dropdown-item" href="../articles/findDoubletClusters.html">Detecting clusters of doublet cells with DE analyses</a></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to the scDblFinder package</a></li>
    <li><a class="dropdown-item" href="../articles/recoverDoublets.html">Recovering intra-sample doublets</a></li>
    <li><a class="dropdown-item" href="../articles/scATAC.html">Doublet identifiation in single-cell ATAC-seq</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/plger/scDblFinder/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Detect doublet clusters</h1>
      <small class="dont-index">Source: <a href="https://github.com/plger/scDblFinder/blob/devel/R/findDoubletClusters.R" class="external-link"><code>R/findDoubletClusters.R</code></a></small>
      <div class="d-none name"><code>findDoubletClusters.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Identify potential clusters of doublet cells based on whether they have intermediate expression profiles,
i.e., their profiles lie between two other “source” clusters.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">findDoubletClusters</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'ANY'</span></span>
<span><span class="fu">findDoubletClusters</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">clusters</span>,</span>
<span>  subset.row <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  get.all.pairs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'SummarizedExperiment'</span></span>
<span><span class="fu">findDoubletClusters</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, assay.type <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'SingleCellExperiment'</span></span>
<span><span class="fu">findDoubletClusters</span><span class="op">(</span><span class="va">x</span>, clusters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/colLabels.html" class="external-link">colLabels</a></span><span class="op">(</span><span class="va">x</span>, onAbsence <span class="op">=</span> <span class="st">"error"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A numeric matrix-like object of count values,
where each column corresponds to a cell and each row corresponds to an endogenous gene.</p>
<p>Alternatively, a <a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">SummarizedExperiment</a> or <a href="https://rdrr.io/pkg/SingleCellExperiment/man/SingleCellExperiment.html" class="external-link">SingleCellExperiment</a> object containing such a matrix.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>For the generic, additional arguments to pass to specific methods.</p>
<p>For the ANY method, additional arguments to pass to <code>findMarkers</code>.</p>
<p>For the SummarizedExperiment method, additional arguments to pass to the ANY method.</p>
<p>For the SingleCellExperiment method, additional arguments to pass to the SummarizedExperiment method.</p></dd>


<dt id="arg-clusters">clusters<a class="anchor" aria-label="anchor" href="#arg-clusters"></a></dt>
<dd><p>A vector of length equal to <code>ncol(x)</code>, containing cluster identities for all cells.
If <code>x</code> is a SingleCellExperiment, this is taken from <code><a href="https://rdrr.io/pkg/SingleCellExperiment/man/colLabels.html" class="external-link">colLabels</a>(x)</code> by default.</p></dd>


<dt id="arg-subset-row">subset.row<a class="anchor" aria-label="anchor" href="#arg-subset-row"></a></dt>
<dd><p>See <code>?"scran-gene-selection"</code>.</p></dd>


<dt id="arg-threshold">threshold<a class="anchor" aria-label="anchor" href="#arg-threshold"></a></dt>
<dd><p>A numeric scalar specifying the FDR threshold with which to identify significant genes.</p></dd>


<dt id="arg-get-all-pairs">get.all.pairs<a class="anchor" aria-label="anchor" href="#arg-get-all-pairs"></a></dt>
<dd><p>Logical scalar indicating whether statistics for all possible source pairings should be returned.</p></dd>


<dt id="arg-assay-type">assay.type<a class="anchor" aria-label="anchor" href="#arg-assay-type"></a></dt>
<dd><p>A string specifying which assay values to use, e.g., <code>"counts"</code> or <code>"logcounts"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A DataFrame containing one row per query cluster with the following fields:</p><dl><dt><code>source1</code>:</dt>
<dd><p>String specifying the identity of the first source cluster.</p></dd>

<dt><code>source2</code>:</dt>
<dd><p>String specifying the identity of the second source cluster.</p></dd>

<dt><code>num.de</code>:</dt>
<dd><p>Integer, number of genes that are significantly non-intermediate
in the query cluster compared to the two putative source clusters.</p></dd>

<dt><code>median.de</code>:</dt>
<dd><p>Integer, median number of genes that are significantly non-intermediate
in the query cluster across all possible source cluster pairings.</p></dd>

<dt><code>best</code>:</dt>
<dd><p>String specifying the identify of the top gene with the lowest p-value
against the doublet hypothesis for this combination of query and source clusters.</p></dd>

<dt><code>p.value</code>:</dt>
<dd><p>Numeric, containing the adjusted p-value for the <code>best</code> gene.</p></dd>

<dt><code>lib.size1</code>:</dt>
<dd><p>Numeric, ratio of the median library sizes for the first source cluster to the query cluster.</p></dd>

<dt><code>lib.size2</code>:</dt>
<dd><p>Numeric, ratio of the median library sizes for the second source cluster to the query cluster.</p></dd>

<dt><code>prop</code>:</dt>
<dd><p>Numeric, proportion of cells in the query cluster.</p></dd>

<dt><code>all.pairs</code>:</dt>
<dd><p>A SimpleList object containing the above statistics
for every pair of potential source clusters, if <code>get.all.pairs=TRUE</code>.</p></dd>


</dl><p>Each row is named according to its query cluster.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function detects clusters of doublet cells in a manner similar to the method used by Bach et al. (2017).
For each “query” cluster, we examine all possible pairs of “source” clusters,
hypothesizing that the query consists of doublets formed from the two sources.
If so, gene expression in the query cluster should be strictly intermediate
between the two sources after library size normalization.</p>
<p>We apply pairwise t-tests to the normalized log-expression profiles to reject this null hypothesis.
This is done by identifying genes that are consistently up- or down-regulated in the query compared to <em>both</em> sources.
We count the number of genes that reject the null hypothesis at the specified FDR <code>threshold</code>.
For each query cluster, the most likely pair of source clusters is that which minimizes the number of significant genes.</p>
<p>Potential doublet clusters are identified using the following characteristics, in order of importance:</p><ul><li><p>Low number of significant genes (i.e., <code>num.de</code>).
Ideally, <code>median.de</code> is also high to indicate that the absence of strong DE is not due to a lack of power.</p></li>
<li><p>A reasonable proportion of cells in the cluster, i.e., <code>prop</code>.
This requires some expectation of the doublet rate in the experimental protocol.</p></li>
<li><p>Library sizes of the source clusters that are below that of the query cluster, i.e., <code>lib.size*</code> values below unity.
This assumes that the doublet cluster will contain more RNA and have more counts than either of the two source clusters.</p></li>
</ul><p>For each query cluster, the function will only report the pair of source clusters with the lowest <code>num.de</code>.
Setting <code>get.all.pairs=TRUE</code> will retrieve statistics for all pairs of potential source clusters.
This can be helpful for diagnostics to identify relationships between specific clusters.</p>
<p>The reported <code>p.value</code> is of little use in a statistical sense, and is only provided for inspection.
Technically, it could be treated as the Simes combined p-value against the doublet hypothesis for the query cluster.
However, this does not account for the multiple testing across all pairs of clusters for each chosen cluster,
especially as we are chosing the pair that is most concordant with the doublet null hypothesis.</p>
<p>We use library size normalization (via <code><a href="https://rdrr.io/pkg/scuttle/man/librarySizeFactors.html" class="external-link">librarySizeFactors</a></code>) even if existing size factors are present.
This is because intermediate expression of the doublet cluster is not guaranteed for arbitrary size factors.
For example, expression in the doublet cluster will be higher than that in the source clusters if normalization was performed with spike-in size factors.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Bach K, Pensa S, Grzelak M, Hadfield J, Adams DJ, Marioni JC and Khaled WT (2017).
Differentiation dynamics of mammary epithelial cells revealed by single-cell RNA sequencing.
<em>Nat Commun.</em> 8, 1:2128.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code>findMarkers</code>, to detect DE genes between clusters.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Aaron Lun</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Mocking up an example.</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="mockDoubletSCE.html">mockDoubletSCE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">300</span>,<span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute doublet-ness of each cluster:</span></span></span>
<span class="r-in"><span><span class="va">dbl</span> <span class="op">&lt;-</span> <span class="fu">findDoubletClusters</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/dge.html" class="external-link">counts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>, <span class="va">sce</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dbl</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 3 rows and 9 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              source1     source2    num.de median.de        best      p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;character&gt; &lt;character&gt; &lt;integer&gt; &lt;integer&gt; &lt;character&gt;    &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cluster1    cluster3    cluster2        90        90      gene12  4.73777e-94</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cluster2    cluster3    cluster1        90        90     gene171 1.11151e-101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cluster3    cluster2    cluster1       112       112      gene27  3.50989e-74</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          lib.size1 lib.size2      prop</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cluster1  1.096267  1.064833  0.308311</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cluster2  1.029520  0.939114  0.423592</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cluster3  0.971326  0.912186  0.268097</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Narrow this down to clusters with very low 'N':</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scuttle</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/isOutlier.html" class="external-link">isOutlier</a></span><span class="op">(</span><span class="va">dbl</span><span class="op">$</span><span class="va">num.de</span>, log<span class="op">=</span><span class="cn">TRUE</span>, type<span class="op">=</span><span class="st">"lower"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "outlier.filter" "logical"       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"thresholds")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  lower higher </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     90    Inf </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get help from "lib.size" below 1.</span></span></span>
<span class="r-in"><span><span class="va">dbl</span><span class="op">$</span><span class="va">lib.size1</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">dbl</span><span class="op">$</span><span class="va">lib.size2</span> <span class="op">&lt;</span> <span class="fl">1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE FALSE  TRUE</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pierre-Luc Germain.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

